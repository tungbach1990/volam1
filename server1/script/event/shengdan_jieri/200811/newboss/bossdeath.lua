local tbAwardItem = 
{
	{szName="Lôc Thñy Tinh", nCount=2, tbProp={4, 240, 1, 1, 0, 0}},
	{szName="Lam Thñy Tinh", nCount=2, tbProp={4, 238, 1, 1, 0, 0}},
	{szName="Tö Thñy Tinh", nCount=2, tbProp={4, 239, 1, 1, 0, 0}},
	{szName="Tinh Hång B¶o Th¹ch", nCount=2, tbProp={4, 353, 1, 1, 0, 0}},
	{szName="Tiªn Th¶o Lé ", nCount=5, tbProp={6, 1, 71, 1, 0, 0}},
	{szName="Phóc Duyªn Lé (§¹i) ", nCount=5, tbProp={6, 1, 124, 1, 0, 0}},
	{szName="Phóc Duyªn Lé (Trung) ", nCount=5, tbProp={6, 1, 123, 1, 0, 0}},
	{szName="Phóc Duyªn Lé (TiÓu) ", nCount=5, tbProp={6, 1, 122, 1, 0, 0}},
	{szName="HuyÒn tinh kho¸ng th¹ch cÊp 4", nCount=1, tbProp={6, 1, 147, 4, 0, 0}},
	{szName="HuyÒn tinh kho¸ng th¹ch cÊp 5", nCount=1, tbProp={6, 1, 147, 5, 0, 0}},
	{szName="HuyÒn tinh kho¸ng th¹ch cÊp 6", nCount=1, tbProp={6, 1, 147, 6, 0, 0}},
	{szName="HuyÒn tinh kho¸ng th¹ch cÊp 7", nCount=1, tbProp={6, 1, 147, 7, 0, 0}},
	{szName="HuyÒn tinh kho¸ng th¹ch cÊp 8", nCount=1, tbProp={6, 1, 147, 8, 0, 0}},
	{szName="Vâ L©m MËt TÞch", nCount=1, tbProp={6, 1, 26, 1, 0, 0}},
	{szName="TÈy Tñy Kinh", nCount=1, tbProp={6, 1, 22, 1, 0, 0}},
	{szName="ThiÕt La H¸n", nCount=5, tbProp={6, 1, 23, 1, 0, 0}},
	{szName="Bµn Nh­îc T©m Kinh", nCount=5, tbProp={6, 1, 12, 1, 0, 0}},
	{szName="T©m T©m T­¬ng ¸nh phï ", nCount=5, tbProp={6, 1, 18, 1, 0, 0}},
	{szName="Phi Phong", nCount=5, tbProp={6, 1, 15, 1, 0, 0}},
	{szName="B¸ch Qu¶ Lé ", nCount=5, tbProp={6, 1, 73, 1, 0, 0}},
	{szName="Thiªn s¬n  B¶o Lé ", nCount=5, tbProp={6, 1, 72, 1, 0, 0}},
	{szName="Nhu T×nh C©n Quèc Nghª Th­êng", nQuality=1, nCount=1, tbProp={0, 190}},
	{szName="Nhu T×nh  TuÖ T©m Ngäc Béi", nQuality=1, nCount=1, tbProp={0, 193}},
	{szName="Nhu T×nh  Phông Nghi Giíi ChØ ", nQuality=1, nCount=5, tbProp={0, 192}},
	{szName="Nhu T×nh Thôc N÷ H¹ng Liªn", nQuality=1, nCount=5, tbProp={0, 191}},
	{szName="HiÖp Cèt T×nh ý KÕt", nQuality=1, nCount=1, tbProp={0, 189}},
	{szName="HiÖp Cèt ThiÕt HuyÕt Sam", nQuality=1, nCount=1, tbProp={0, 186}},
	{szName="HiÖp Cèt §an T©m Giíi", nQuality=1, nCount=5, tbProp={0, 188}},
	{szName="HiÖp Cèt §a T×nh Hoµn", nQuality=1, nCount=5, tbProp={0, 187}},
	{szName="§Þnh Quèc ¤ Sa Ph¸t Qu¸n", nQuality=1, nCount=1, tbProp={0, 160}},
	{szName="§Þnh Quèc Thanh Sa Tr­êng Sam", nQuality=1, nCount=1, tbProp={0, 159}},
	{szName="§Þnh Quèc Ng©n Tµm Yªu ®¸i", nQuality=1, nCount=1, tbProp={0, 163}},
	{szName="§Þnh Quèc XÝch Quyªn NhuyÔn Ngoa", nQuality=1, nCount=1, tbProp={0, 161}},
	{szName="§Þnh Quèc Tö §»ng Hé uyÓn", nQuality=1, nCount=1, tbProp={0, 162}},
	{szName="§å phæ Hoµng Kim - Tø Kh«ng Gi¸ng Ma Giíi §ao", nCount=1, tbProp={6, 1, 249, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - H¸m Thiªn Kim Hoµn §¹i Nh·n ThÇn Chïy", nCount=1, tbProp={6, 1, 254, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - B¨ng Hµn §¬n ChØ Phi §ao", nCount=1, tbProp={6, 1, 309, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - U Lung Kim Xµ Ph¸t §¸i", nCount=1, tbProp={6, 1, 294, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - V« Ma TÈy T­îng Ngäc KhÊu", nCount=1, tbProp={6, 1, 277, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - Tª Hoµng Phông Nghi §ao", nCount=1, tbProp={6, 1, 284, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - §ång Cõu Kh¸ng Long Hé UyÓn", nCount=1, tbProp={6, 1, 332, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - Ma S¸t Quû Cèc U Minh Th­¬ng", nCount=1, tbProp={6, 1, 339, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - S­¬ng Tinh Thiªn Niªn Hµn ThiÕt", nCount=1, tbProp={6, 1, 364, 1, 0, 0}},
	{szName="§å phæ Hoµng Kim - L¨ng Nh¹c V« Cùc HuyÒn Ngäc Béi", nCount=1, tbProp={6, 1, 357, 1, 0, 0}},
	{szName="§­êng Nghª gi¸p", nCount=5, tbProp={0, 2, 4, 10, nil, 0}},
	{szName="Thiªn Tµm Hé UyÓn", nCount=5, tbProp={0, 8, 1, 10, nil, 0}},
	{szName="Thiªn Tµm Ngoa", nCount=5, tbProp={0, 5, 1, 10, nil, 0}},
	{szName="Thiªn Tµm Yªu §¸i", nCount=5, tbProp={0, 6, 0, 10, nil, 0}},
	{szName="YÓm NhËt kh«i", nCount=5, tbProp={0, 7, 4, 10, nil, 0}},
	{szName="Toµn Th¹ch Giíi ChØ", nCount=5, tbProp={0, 3, 0, 10, nil, 0}},

}


local tbDropItem = {}
function tbDropItem:DropItemdByRate(tbItem, szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
	if tbItem == nil then
		return 0
	end
	local rtotal = 10000000
	local rcur=random(1,rtotal);
	local rstep=0;
	for i=1,getn(tbItem) do
		rstep=rstep+floor(tbItem[i].nRate*rtotal/100);
		if(rcur <= rstep) then
			return self:DropItemByList(tbItem[i], szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
		end
	end
end

function tbDropItem:DropItemByList(tbItem, szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
	if not tbItem then --ÎïÆ·±íÎª¿Õ
		self:Debug("B¶ng vËt phÈm trèng.")
		return 0
	end
	if type(tbItem[1]) == "table" then -- Èç¹ûÊÇ¶à¸öÎïÆ·
		if tbItem[1].nRate then --°´¸ÅÂÊ¸øÄ³Ò»¸ö
			return self:DropItemdByRate(tbItem, szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
		else --°´Ë³Ðò¸øÈ«²¿
			for i = 1,  getn(tbItem) do
				self:DropItemByList(tbItem[i], szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
			end	
			return 1;
		end
	end
	local tbItemProp	= tbItem.tbProp;
	local nItemCount	= tbItem.nCount or 1
	if tbItemProp then --ÎïÆ·
		local nItemIndex	= 0;
		for i = 1, nItemCount do
			local nQuality		= tbItem.nQuality or 0
			local nGoldRow		= 0
			local nItemSeries	= 0;
			local nItemLevel	= 0;
			local nItemLuck		= 0;
			if nQuality == 0 then
				nItemLevel = tbItemProp[4] or 1 --Ä¬ÈÏµÈ¼¶
				
				if (not tbItemProp[5]) then
					nItemSeries = nSeries or 0
					
				else
					nItemSeries = tbItemProp[5];
				end
				
				nItemLuck = tbItemProp[6] or 0
			elseif nQuality == 1 then
				nGoldRow = 1
			end
			nItemIndex = DropItemEx( SubWorldID2Idx(nMapId), nPosX32, nPosY32, -1,4, 0, nQuality, tbItemProp[1], tbItemProp[2] - nGoldRow, tbItemProp[3] or 0, nItemLevel, nItemSeries, nItemLuck,0,0,0,0,0)
			if nItemIndex <= 0 then
				return 0
			end
			if type(tbItem.CallBack) == "function" then
				tbItem.CallBack(nItemIndex)
			end
		end
		local szItemName = tbItem.szName or GetItemName(nItemIndex) --Í¬ÀàÎïÆ·Òò´ËÑ¡×îºóµÄIndexÃû×ÖÒ²Ò»Ñù
		self:WriteLog(szLogTitle, format("get %d item %s", nItemCount, szItemName))
	end
	if tbItem.nJxb then --½£ÏÀ±Ò
		
	end
	return 1
end

function tbDropItem:WriteLog(szLogTitle, szMsg)
--	if szLogTitle then
--		WriteLog(format("[%s]\t%s\tAccount:%s\tName:%s\t%s.",szLogTitle,GetLocalDate("%Y-%m-%d %H:%M"), GetAccount(), GetName(), szMsg))
--	else
--		self:Debug("Ìí¼ÓÎïÆ·º¯ÊýÃ»ÓÐÈÕÖ¾¡£")
--	end
end
--Include("\\script\\event\\shengdan_jieri\\200811\\newboss\\actclass.lua")
function OnDeath( nNpcIndex )
	local x, y, nMapIndex = GetNpcPos(nNpcIndex);
	local nSeries = GetNpcSeries(nNpcIndex);
	
	%tbDropItem:DropItemByList(%tbAwardItem, "Chunjie_Jieri2009_newboss_death", SubWorldIdx2ID(nMapIndex),x, y, nSeries)
	
end;


function OnTimer(nNpcIndex, nTimeOut)
	DelNpc(nNpcIndex)
end