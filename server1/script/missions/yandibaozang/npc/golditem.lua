Include("\\script\\task\\system\\task_string.lua")




YDBZ_item_suipian_ID = {6,1,1606}		--ËéÆ¬ID
YDBZ_tbgolditem = {
	[1]={--Ãû³Æ£¬ĞèÒªËéÆ¬£¬ÎïÆ·ID£¨g,d,p£©
			"Bé trang bŞ To¹i Nh©n [Kim]",	
			{"To¹i Nh©n Xİch HuyÕt Nguyªn Vò Gi¸p",50,6,1,1536,"{{Sinh lùc lín nhÊt}}180-240<enter>{{Gi¶m bít thêi gian ®éng t¸c s¸t th­¬ng}}45-55<enter>{{Gi¶m thêi gian cho¸ng}}30-50<enter>{{TrŞ phßng háa lín nhÊt}}25-30<enter>{{PhÇn tr¨m s¸t th­¬ng vËt lı hÖ ngo¹i c«ng}}30-50"},
			{"To¹i Nh©n B¸ch LuyÖn Kh«i",45,6,1,1537,"<enter>{{Sinh lùc lín nhÊt}}180-240<enter>{{Háa phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian ®ãng b¨ng}}30-50<enter>{{PhÇn tr¨m s¸t th­¬ng vËt lı hÖ ngo¹i c«ng}}30-50"},
			{"To¹i Nh©n Trôc Thiªn Ngoa",38,6,1,1539,"{{Sinh lùc lín nhÊt}}180-240<enter>{{T¨ng tèc ®é di chuyÓn}}40-50<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Phæ phßng lín nhÊt}}25-30<enter>{{T¨ng l«i s¸t hÖ néi c«ng}}80-120"},	
			{"To¸i Nh©n Kim Lò NhuyÔn Vi Hé UyÓn",38,6,1,1540,"{{Sinh lùc lín nhÊt}}180-240<enter>{{B¨ng phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian cho¸ng}}30-50<enter>{{T¨ng háa s¸t hÖ néi c«ng}}80-120"},	
	},
	[2]={
			"Bé trang bŞ Phôc Hy [Méc]",	
			{"Phôc Hi Hoan ¶nh KŞch",38,6,1,1549,"{{Sinh lùc lín nhÊt}}180-240<enter>{{T¨ng tèc ®é di chuyÓn}}40-50<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{B¨ng phßng lín nhÊt}}25-30<enter>{{PhÇn tr¨m s¸t th­¬ng vËt lı hÖ ngo¹i c«ng}}30-50"},	
			{"Phôc Hi V« L­îng TŞch Tµ Thñ",38,6,1,1550,"{{Sinh lùc lín nhÊt}}180-240<enter>{{B¨ng phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian cho¸ng}}30-50<enter>{{T¨ng s¸t th­¬ng chİ m¹ng}}3-5"},	
			{"Phôc Hi To¸i T©m",30,6,1,1551,"{{Sinh lùc lín nhÊt}}180-240<enter>{{§éc phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian tróng ®éc}}30-50<enter>{{T¨ng ®éc s¸t hÖ néi c«ng}}50-60"},	
	},
	[3]={
			"Bé trang bŞ N÷ Oa [Thñy]",	
			{"N÷ Oa Hång Nhan Ph¸t §¸i",38,6,1,1557,"{{Sinh lùc lín nhÊt}}180-240<enter>{{Phæ phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian cho¸ng}}30-50<enter>{{PhÇn tr¨m s¸t th­¬ng vËt lı hÖ ngo¹i c«ng}}30-50"},	
			{"N÷ Oa Lôc NghÖ Nghª Th­êng Thóc §¸i",38,6,1,1558,"{{Sinh lùc lín nhÊt}}180-240<enter>{{L«i phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian tróng ®éc}}30-50<enter>{{S¸t th­¬ng chuyÓn thµnh néi c«ng}}6-10"},	
			{"N÷ Oa Hµn T­¬ng",50,6,1,1561,"{{Sinh lùc lín nhÊt}}180-240<enter>{{B¨ng phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian tróng ®éc}}30-50<enter>{{T¨ng b¨ng s¸t hÖ néi c«ng}}200-300"},	
	},
	[4]={
			"Bé trang bŞ Chóc Dung [Háa]",
			{"Chóc Dung LiÖt DiÖm Né Phong Trang",45,6,1,1566,"{{Sinh lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian ®éng t¸c bŞ th­¬ng}}45-55<enter>{{Gi¶m thêi gian tróng ®éc}}30-50<enter>{{Phæ phßng lín nhÊt}}25-30<enter>{{S¸t th­¬ng chuyÓn thµnh néi c«ng}}6-10"},	
			{"Chóc Dung Kinh Chİch BÊt DiÖt Tr¶o",38,6,1,1570,"{{Sinh lùc lín nhÊt}}180-240<enter>{{Phæ phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian ®ãng b¨ng}}30-50<enter>{{T¨ng b¨ng s¸t hÖ néi c«ng}}80-120"},	
			{"Chóc Dung Ph¸ NhËt",38,6,1,1571,"{{Sinh lùc lín nhÊt}}180-240<enter>{{Háa phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian ®ãng b¨ng}}30-50<enter>{{T¨ng háa s¸t hÖ néi c«ng}}200-300"},	
	},
	[5]={
			"Bé trang bŞ ThÇn N«ng [Thæ]",	
			{"ThÇn N«ng Tiªu D­¬ng §Şa Hoµng Y",50,6,1,1576,"{{Sinh lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian ®éng t¸c bŞ th­¬ng}}45-55<enter>{{Gi¶m thêi gian cho¸ng}}30-50<enter>{{Phæ phßng lín nhÊt}}25-30<enter>{{PhÇn tr¨m s¸t th­¬ng vËt lı hÖ ngo¹i c«ng}}30-50"},	
			{"ThÇn N«ng Né L«i §Çu Hoµn",38,6,1,1577,"{{Sinh lùc lín nhÊt}}180-240<enter>{{L«i phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian ®ãng b¨ng}}30-50<enter>{{S¸t th­¬ng chuyÓn thµnh néi c«ng}}6-10"},	
			{"ThÇn N«ng Ngù Phong L÷",40,6,1,1579,"{{Sinh lùc lín nhÊt}}180-240<enter>{{T¨ng tèc ®é di chuyÓn}}40-50<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{B¨ng phßng lín nhÊt}}25-30<enter>{{T¨ng háa s¸t hÖ néi c«ng}}80-120"},	
			{"ThÇn N«ng Tr¶m Nh¹c",30,6,1,1581,"{{Sinh lùc lín nhÊt}}180-240<enter>{{§éc phßng lín nhÊt}}25-30<enter>{{Néi lùc lín nhÊt}}180-240<enter>{{Gi¶m thêi gian cho¸ng}}30-50<enter>{{T¨ng l«i s¸t hÖ néi c«ng}}200-300"},	
	},
}
function YDBZ_golditem()
	local nlen = getn(YDBZ_tbgolditem)
	local tbfun =  {}
	tbfun[1] = "<dec><npc>Xin mêi chän ®å phæ hoµng kim viªm ®Õ!!"
	tbfun[2] = "Ta chØ ghĞ ngang th«i./NoChoice"
	for i = nlen,1,-1 do 
		tinsert(tbfun,2,YDBZ_tbgolditem[i][1] .. format("/#YDBZ_golditem_chose(%s)",i) )
	end
	CreateTaskSay(tbfun)
end

function YDBZ_golditem_chose(nchose)
	local nlen = getn(YDBZ_tbgolditem[nchose])
	local tbfun =  {}
	tbfun[1] = format("<dec><npc>Xin c¸c h¹ h·y chän ®å phæ cña <color=yellow>%s<color>.",YDBZ_tbgolditem[nchose][1])
	tbfun[2] = "Ta chØ ghĞ ngang th«i./NoChoice"
	for i = nlen-1,1,-1 do 
		tinsert(tbfun,2,YDBZ_tbgolditem[nchose][i+1][1] .. format("/#YDBZ_golditem_get(%s,%s)",nchose,i+1) )
	end
	CreateTaskSay(tbfun)	
end

function YDBZ_golditem_get(nchose,ni)
	local nlen = getn(YDBZ_tbgolditem[nchose])
	local tbfun =  {}
	tbfun[1] = format("<dec><npc>C¸c h¹ muèn <color=yellow>®å phæ %s<color> cña <color=yellow>%s<color> cÇn ph¶i cã <color=yellow>%s<color> viªm ®Õ ®å ®»ng míi cã thÓ ®æi ®­îc. C¸c h¹ muèn ®æi kh«ng?<enter>Sau khi ghĞp ®å phæ xong th× thuéc tİnh trang bŞ nh­ bªn d­íi: <enter>%s",YDBZ_tbgolditem[nchose][1],YDBZ_tbgolditem[nchose][ni][1],YDBZ_tbgolditem[nchose][ni][2],YDBZ_tbgolditem[nchose][ni][6])
	tbfun[2] = format("§óng, ta cÇn ®æi/#YDBZ_golditem_getyes(%s,%s)",nchose,ni)
	tbfun[3] = "Ta chØ ghĞ ngang th«i./NoChoice"
	CreateTaskSay(tbfun)		
end

function YDBZ_golditem_getyes(nchose,ni)
	local nitemc = YDBZ_tbgolditem[nchose][ni][2]
	local g = YDBZ_item_suipian_ID[1]
	local d = YDBZ_item_suipian_ID[2]
	local p = YDBZ_item_suipian_ID[3]
	local ncount = CalcEquiproomItemCount(g,d,p,-1)
	if ncount < nitemc then
		Say("C¸c h¹ kh«ng ®ñ viªm ®Õ ®å ®»ng ®Ó ®æi ®å phæ hoµng kim viªm ®Õ nµy.",0)
		return
	end
	ConsumeEquiproomItem(nitemc, g, d, p, -1)
	local ng = YDBZ_tbgolditem[nchose][ni][3]
	local nd = YDBZ_tbgolditem[nchose][ni][4]
	local np = YDBZ_tbgolditem[nchose][ni][5]
	AddItem(ng,nd,np,1,0,0)
	Msg2Player(format("C¸c h¹ thu ®­îc 1 hoµng kim ®å phæ - <color=yellow>%s<color>",YDBZ_tbgolditem[nchose][ni][1]))
	YDBZ_sdl_writeLog("§æi hoµng kim ®å phæ",format("Dïng %s viªm ®Õ ®å ®¨ng ®æi thµnh c«ng %s",nitemc,YDBZ_tbgolditem[nchose][ni][1]))
end

function YDBZ_sdl_writeLog(sztitle,szevent)	--¼ÇÂ¼,sztitle=ÊÂ¼şÃû,szevent=ÊÂ¼şÄÚÈİ
	WriteLog(format("[%s]\t Date:%s\t Account:%s\t Name:%s\t %s",sztitle,GetLocalDate("%y-%m-%d %H:%M:%S"),GetAccount(),GetName(),szevent));
end