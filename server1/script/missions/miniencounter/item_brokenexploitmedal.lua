Include("\\script\\missions\\miniencounter\\publicdef.lua");

function main(nItemIndex)
	local nTaskValue = GetTask(DungeonGlobalData.BROKEN_MEDAL_USE_PER_WEEK);
	local nCurrentUseTimes = GetByte(nTaskValue, 2)
	local nWeek = GetByte(nTaskValue, 1)
	local nCurWeek = tonumber(GetLocalDate("%W"))
	
	if nCurWeek ~= nWeek then
		nTaskValue = SetByte(nTaskValue, 1, nCurWeek)
		nCurrentUseTimes = 0
		nTaskValue = SetByte(nTaskValue, 2, nCurrentUseTimes)
	end
	
	if nCurrentUseTimes >= 5 then
		Msg2Player("M¶nh hu©n ch­¬ng Tèng Kim mçi tuÇn sö dông nhiÒu nhÊt 5 c¸i, ®¹i hiÖp ®îi tuÇn sau xµi l¹i ®i!");
		return 1;
	end

	nCurrentUseTimes = nCurrentUseTimes + 1;
	nTaskValue = SetByte(nTaskValue, 2, nCurrentUseTimes)
	SetTask(DungeonGlobalData.BROKEN_MEDAL_USE_PER_WEEK, nTaskValue);

	SetTask(
		DungeonGlobalData.PLAYER_EXPLOIT_TASK_VALUE,
		GetTask(DungeonGlobalData.PLAYER_EXPLOIT_TASK_VALUE) + 700
	);

	SetTask(
		DungeonGlobalData.PLAYER_HISTORY_EXPLOIT_TASK_VALUE,
		GetTask(DungeonGlobalData.PLAYER_HISTORY_EXPLOIT_TASK_VALUE) + 700
	);

	Msg2Player("Ng­¬i nhËn ®­îc 700 c«ng hu©n Tèng Kim!");
	return nil;
end
