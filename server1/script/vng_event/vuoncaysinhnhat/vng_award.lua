Include("\\script\\lib\\awardtemplet.lua")
tbSpecialAward = {}
tbSpecialAward.tbAward = 
{
	[1] = {szName="§å Phæ Tö M·ng Kh«i",tbProp={6,1,2714,1,0,0},nCount=1},
	[2] = {szName="§å Phæ Tö M·ng Y",tbProp={6,1,2715,1,0,0},nCount=1},
	[3] = {szName="§å Phæ Tö M·ng Yªu §¸i",tbProp={6,1,2717,1,0,0},nCount=1},
	[4] = {szName="§å Phæ Tö M·ng Hé UyÓn",tbProp={6,1,2718,1,0,0},nCount=1},
	[5] = {szName="§å Phæ Tö M·ng Béi",tbProp={6,1,2720,1,0,0},nCount=1},
	[6] = {szName="§å Phæ Tö M·ng Hµi",tbProp={6,1,2716,1,0,0},nCount=1},
	[7] = {szName="§å Phæ Tö M·ng H¹ng Liªn",tbProp={6,1,2719,1,0,0},nCount=1},
	[8] = {szName="§å Phæ Tö M·ng Th­îng Giíi ChØ",tbProp={6,1,2721,1,0,0},nCount=1},
	[9] = {szName="§å Phæ Tö M·ng H¹ Giíi ChØ",tbProp={6,1,2722,1,0,0},nCount=1},
	[10] = {szName="§å Phæ Tö M·ng KhÝ Giíi",tbProp={6,1,2723,1,0,0},nCount=1},
}
tbSpecialAward.tbAward2 = 
{
	[3] = --h¹ng liªn tØ lÖ 65%
	{
		[1] = --thiÕu l©m
		{
			{szName="Tö M·ng V« T­¬ng Ch©u Liªn",tbProp={0,1825},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tø Kh«ng PhËt Ch©u",tbProp={0,1835},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh TÞnh H¹ng Liªn",tbProp={0,1845},nCount=1,nQuality = 1,},
		},
		[2] = --thiªn v­¬ng
		{
			{szName="Tö M·ng Sïng Minh Liªn",tbProp={0,1855},nCount=1,nQuality = 1,},
			{szName="Tö M·ng §Þnh H¶i H¹ng Liªn",tbProp={0,1865},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tuyªn Uy H¹ng Liªn",tbProp={0,1875},nCount=1,nQuality = 1,},
		},
		[3] = --nga my
		{
			{szName="Tö M·ng XuÊt TrÇn Ch©u Liªn",tbProp={0,1885},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Méc TuyÕt Ch©u Liªn",tbProp={0,1895},nCount=1,nQuality = 1,},
		},
		[4] = --thóy yªn
		{
			{szName="Tö M·ng Thanh S­¬ng Ch©u Liªn",tbProp={0,1905},nCount=1,nQuality = 1,},
			{szName="Tö M·ng ThÕ H­¬ng Ch©u Liªn",tbProp={0,1915},nCount=1,nQuality = 1,},
		},
		[5] = --ngò ®éc
		{
			{szName="Tö M·ng Thùc Cèt H¹ng Liªn",tbProp={0,1925},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Xuyªn T©m H¹ng Liªn",tbProp={0,1935},nCount=1,nQuality = 1,},
		},
		[6] = --®­êng m«n
		{
			{szName="Tö M·ng Lang Nha H¹ng Liªn",tbProp={0,1945},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh Vô H¹ng Liªn",tbProp={0,1955},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Phong S­¬ng H¹ng Liªn",tbProp={0,1965},nCount=1,nQuality = 1,},
		},
		[7] = --c¸i bang
		{
			{szName="Tö M·ng MËt V©n H¹ng Liªn",tbProp={0,1975},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Háa V©n H¹ng Liªn",tbProp={0,1985},nCount=1,nQuality = 1,},
		},
		[8] = --thiªn nhÉn
		{
			{szName="Tö M·ng Dung Kim H¹ng Khuyªn",tbProp={0,1995},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Liªu Nguyªn H¹ng Liªn",tbProp={0,2005},nCount=1,nQuality = 1,},
		},
		[9] = --vâ ®ang
		{
			{szName="Tö M·ng Ch©n Viªn Phï",tbProp={0,2015},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Ch©n Vò Phï",tbProp={0,2025},nCount=1,nQuality = 1,},
		},
		[10] = --c«n l«n
		{
			{szName="Tö M·ng §o¹n Thñy H¹ng Liªn",tbProp={0,2035},nCount=1,nQuality = 1,},
			{szName="Tö M·ng TrÝch Tinh Phï",tbProp={0,2045},nCount=1,nQuality = 1,},
		},
	},
	[4] = --th­îng giíi tØ lÖ 15%
	{
		[1] = --thiÕu l©m
		{
			{szName="Tö M·ng V« T­¬ng Th­îng Giíi",tbProp={0,1827},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tø Kh«ng Th­îng Giíi",tbProp={0,1837},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh TÞnh Th­îng Giíi",tbProp={0,1847},nCount=1,nQuality = 1,},
		},
		[2] = --thiªn v­¬ng
		{
			{szName="Tö M·ng Sïng Minh Th­îng Giíi",tbProp={0,1857},nCount=1,nQuality = 1,},
			{szName="Tö M·ng §Þnh H¶i Th­îng Giíi",tbProp={0,1867},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tuyªn Uy Th­îng Giíi",tbProp={0,1877},nCount=1,nQuality = 1,},
		},
		[3] = --nga my
		{
			{szName="Tö M·ng XuÊt TrÇn Th­îng Giíi",tbProp={0,1887},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Méc TuyÕt Th­îng Giíi",tbProp={0,1897},nCount=1,nQuality = 1,},
		},
		[4] = --thóy yªn
		{
			{szName="Tö M·ng Thanh S­¬ng Th­îng Giíi",tbProp={0,1907},nCount=1,nQuality = 1,},
			{szName="Tö M·ng ThÕ H­¬ng Th­îng Giíi",tbProp={0,1917},nCount=1,nQuality = 1,},
		},
		[5] = --ngò ®éc
		{
			{szName="Tö M·ng Thùc Cèt Th­îng Giíi",tbProp={0,1927},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Xuyªn T©m Th­îng Giíi",tbProp={0,1937},nCount=1,nQuality = 1,},
		},
		[6] = --®­êng m«n
		{
			{szName="Tö M·ng Lang Nha Th­îng Giíi",tbProp={0,1947},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh Vô Th­îng Giíi",tbProp={0,1957},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Phong S­¬ng Th­îng Giíi",tbProp={0,1967},nCount=1,nQuality = 1,},
		},
		[7] = --c¸i bang
		{
			{szName="Tö M·ng MËt V©n Th­îng Giíi",tbProp={0,1977},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Háa V©n Th­îng Giíi",tbProp={0,1987},nCount=1,nQuality = 1,},
		},
		[8] = --thiªn nhÉn
		{
			{szName="Tö M·ng Dung Kim Th­îng Giíi",tbProp={0,1997},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Liªu Nguyªn Th­îng Giíi",tbProp={0,2007},nCount=1,nQuality = 1,},
		},
		[9] = --vâ ®ang
		{
			{szName="Tö M·ng Ch©n Viªn Th­îng Giíi",tbProp={0,2017},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Ch©n Vò Th­îng Giíi",tbProp={0,2027},nCount=1,nQuality = 1,},
		},
		[10] = --c«n l«n
		{
			{szName="Tö M·ng §o¹n Thñy Th­îng Giíi",tbProp={0,2037},nCount=1,nQuality = 1,},
			{szName="Tö M·ng TrÝch Tinh Th­îng Giíi",tbProp={0,2047},nCount=1,nQuality = 1,},
		},
	},
	[5] = --h¹ giíi tØ lÖ 16%
	{
		[1] = --thiÕu l©m
		{
			{szName="Tö M·ng V« T­¬ng H¹ Giíi",tbProp={0,1834},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tø Kh«ng H¹ Giíi",tbProp={0,1844},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh TÞnh H¹ Giíi",tbProp={0,1854},nCount=1,nQuality = 1,},
		},
		[2] = --thiªn v­¬ng
		{
			{szName="Tö M·ng Sïng Minh H¹ Giíi",tbProp={0,1864},nCount=1,nQuality = 1,},
			{szName="Tö M·ng §Þnh H¶i H¹ Giíi",tbProp={0,1874},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tuyªn Uy H¹ Giíi",tbProp={0,1884},nCount=1,nQuality = 1,},
		},
		[3] = --nga my
		{
			{szName="Tö M·ng XuÊt TrÇn H¹ Giíi",tbProp={0,1894},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Méc TuyÕt H¹ Giíi",tbProp={0,1904},nCount=1,nQuality = 1,},
		},
		[4] = --thóy yªn
		{
			{szName="Tö M·ng Thanh S­¬ng H¹ Giíi",tbProp={0,1914},nCount=1,nQuality = 1,},
			{szName="Tö M·ng ThÕ H­¬ng H¹ Giíi",tbProp={0,1924},nCount=1,nQuality = 1,},
		},
		[5] = --ngò ®éc
		{
			{szName="Tö M·ng Thùc Cèt H¹ Giíi",tbProp={0,1934},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Xuyªn T©m H¹ Giíi",tbProp={0,1944},nCount=1,nQuality = 1,},
		},
		[6] = --®­êng m«n
		{
			{szName="Tö M·ng Lang Nha H¹ Giíi",tbProp={0,1954},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh Vô H¹ Giíi",tbProp={0,1964},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Phong S­¬ng H¹ Giíi",tbProp={0,1974},nCount=1,nQuality = 1,},
		},
		[7] = --c¸i bang
		{
			{szName="Tö M·ng MËt V©n H¹ Giíi",tbProp={0,1984},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Háa V©n H¹ Giíi",tbProp={0,1994},nCount=1,nQuality = 1,},
		},
		[8] = --thiªn nhÉn
		{
			{szName="Tö M·ng Dung Kim H¹ Giíi",tbProp={0,2004},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Liªu Nguyªn H¹ Giíi",tbProp={0,2014},nCount=1,nQuality = 1,},
		},
		[9] = --vâ ®ang
		{
			{szName="Tö M·ng Ch©n Viªn H¹ Giíi",tbProp={0,2024},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Ch©n Vò H¹ Giíi",tbProp={0,2034},nCount=1,nQuality = 1,},
		},
		[10] = --c«n l«n
		{
			{szName="Tö M·ng §o¹n Thñy H¹ Giíi",tbProp={0,2044},nCount=1,nQuality = 1,},
			{szName="Tö M·ng TrÝch Tinh H¹ Giíi",tbProp={0,2054},nCount=1,nQuality = 1,},
		},
	},
	[6] = --khÝ giíi tØ lÖ 4%
	{
		[1] = --thiÕu l©m
		{
			{szName="Tö M·ng V« T­¬ng TriÒn Thñ",tbProp={0,1831},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tø Kh«ng T¨ng C«n",tbProp={0,1841},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh TÞnh Giíi §ao",tbProp={0,1851},nCount=1,nQuality = 1,},
		},
		[2] = --thiªn v­¬ng
		{
			{szName="Tö M·ng Sïng Minh Chïy",tbProp={0,1861},nCount=1,nQuality = 1,},
			{szName="Tö M·ng §Þnh H¶i Th­¬ng",tbProp={0,1871},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Tuyªn Uy B¶o §ao",tbProp={0,1881},nCount=1,nQuality = 1,},
		},
		[3] = --nga my
		{
			{szName="Tö M·ng XuÊt TrÇn KiÕm",tbProp={0,1891},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Méc TuyÕt TriÒn Thñ",tbProp={0,1901},nCount=1,nQuality = 1,},
		},
		[4] = --thóy yªn
		{
			{szName="Tö M·ng Thanh S­¬ng §ao",tbProp={0,1911},nCount=1,nQuality = 1,},
			{szName="Tö M·ng ThÕ H­¬ng Uyªn ¦¬ng §ao",tbProp={0,1921},nCount=1,nQuality = 1,},
		},
		[5] = --ngò ®éc
		{
			{szName="Tö M·ng Thùc Cèt TriÒn Thñ",tbProp={0,1931},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Xuyªn T©m §ao",tbProp={0,1941},nCount=1,nQuality = 1,},
		},
		[6] = --®­êng m«n
		{
			{szName="Tö M·ng Lang Nha Phi §ao",tbProp={0,1951},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Thanh Vô Tô TiÔn",tbProp={0,1961},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Phong S­¬ng Tiªu",tbProp={0,1971},nCount=1,nQuality = 1,},
		},
		[7] = --c¸i bang
		{
			{szName="Tö M·ng MËt V©n TriÒn Thñ",tbProp={0,1981},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Háa V©n Tr­îng",tbProp={0,1991},nCount=1,nQuality = 1,},
		},
		[8] = --thiªn nhÉn
		{
			{szName="Tö M·ng Dung Kim Th­¬ng",tbProp={0,2001},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Liªu Nguyªn §ao",tbProp={0,2011},nCount=1,nQuality = 1,},
		},
		[9] = --vâ ®ang
		{
			{szName="Tö M·ng Ch©n Viªn KiÕm",tbProp={0,2021},nCount=1,nQuality = 1,},
			{szName="Tö M·ng Ch©n Vò KiÕm",tbProp={0,2031},nCount=1,nQuality = 1,},
		},
		[10] = --c«n l«n
		{
			{szName="Tö M·ng §o¹n Thñy §ao",tbProp={0,2041},nCount=1,nQuality = 1,},
			{szName="Tö M·ng TrÝch Tinh KiÕm",tbProp={0,2051},nCount=1,nQuality = 1,},	
		},
	},
}

tbSpecialAward.tbFaction = 
{
	[1] = "ThiÕu L©m",
	[2] = "Thiªn V­¬ng",
	[3] = "Nga Mi",
	[4] = "Thóy Yªn",
	[5] = "Ngò §éc",
	[6] = "§­êng M«n",
	[7] = "C¸i Bang",
	[8] = "Thiªn NhÉn",
	[9] = "Vâ §ang",
	[10] = "C«n L«n",
}
tbSpecialAward.tbBranch = 
{
	[1] = {"QuyÒn Ph¸p", "C«n Ph¸p", "§ao Ph¸p",},
	[2] = {"Chïy Ph¸p", "Th­¬ng Ph¸p", "§ao Ph¸p",},
	[3] = {"KiÕm Ph¸p", "Ch­ëng Ph¸p", },
	[4] = {"§ao Ph¸p", "Song §ao", },
	[5] = {"Ch­ëng Ph¸p", "§ao Ph¸p"},
	[6] = {"Phi §ao", "Tô TiÔn", "Phi Tiªu",},
	[7] = {"Ch­ëng Ph¸p", "C«n Ph¸p",},
	[8] = {"Th­¬ng Ph¸p", "§ao Ph¸p"},
	[9] = {"Ch­ëng Ph¸p", "KiÕm Ph¸p", },
	[10] = {"§ao Ph¸p", "KiÕm Ph¸p", },
}
			
function tbSpecialAward:NguyetThan()
	local tbAward = {szName="B¶o r­¬ng may m¾n",tbProp={6,1,30110,1,0,0}, nExpiredTime = 1440, nBindState = -2, nCount=1, tbParam = {1}}
	tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongCayThienTueNguyetThan"})
end

function tbSpecialAward:NguyetThan2(nItemIdx)
	local tbSay = {}
	for i = 1, 7 do
		tinsert(tbSay, format("%s/#tbSpecialAward:GetAward(%d, %d, %d)", self.tbAward[i].szName, nItemIdx, i, 1))
	end
	Say("Xin h·y chän phÇn th­ëng", getn(tbSay), tbSay)
end

function tbSpecialAward:BachKim(nRateIndex)
	local tbItemName = 
	{		
		[3] = "Tö M·ng H¹ng Liªn",
		[4] = "Tö M·ng Th­îng Giíi ChØ",
		[5] = "Tö M·ng H¹ Giíi ChØ",
		[6] = "Tö M·ng KhÝ Giíi",
	}
	local tbAward = {szName="B¶o r­¬ng may m¾n",tbProp={6,1,30110,1,0,0}, nExpiredTime = 1440, nBindState = -2, nCount=1, tbParam = {nRateIndex}}
	tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongCayThienTueBachKim\t"..tbItemName[nRateIndex]})
end

function tbSpecialAward:BachKim2(nItemIdx, nRateIndex)
	local tbSay = {}
	for i = 1, getn(tbSpecialAward.tbFaction) do
		tinsert(tbSay, format("%s/#tbSpecialAward:ChooseBranch(%d, %d, %d)", tbSpecialAward.tbFaction[i], nItemIdx, nRateIndex, i))
	end
	local tbType = {[3]="H¹ng liªn", [4]="Th­îng giíi chØ", [5]="H¹ giíi chØ", [6]="Vò khÝ"}
	local strTittle = format("Xin chóc mõng! §¹i hiÖp nhËn ®­îc phÇn th­ëng lµ 1 <color=red>%s<color>, Xin chän m«n ph¸i:", tbType[nRateIndex])
	Say(strTittle, getn(tbSay), tbSay)
end

function tbSpecialAward:ChooseBranch(nItemIdx, nRateIndex, nFaction)
	local tbSay = {}
	for i = 1, getn(self.tbBranch[nFaction]) do
		tinsert(tbSay, format("%s/#tbSpecialAward:GetAward2(%d, %d, %d, %d)", self.tbFaction[nFaction].." "..self.tbBranch[nFaction][i], nItemIdx, nRateIndex, nFaction, i))
	end
	Say("Xin h·y chän hÖ tÊn c«ng chñ ®¹o:", getn(tbSay), tbSay)
end

function tbSpecialAward:GetAward2(nItemIdx, nRateIndex, nFaction, nBranch)
	local tbAward = self.tbAward2[nRateIndex][nFaction][nBranch]
	if tbAward and IsMyItem(nItemIdx) == 1 and RemoveItemByIndex(nItemIdx) == 1 then
		tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongBaoRuongBachKim"})
	end
end

function tbSpecialAward:BatTu()
	local tbAward = {szName="B¶o r­¬ng may m¾n",tbProp={6,1,30110,1,0,0}, nExpiredTime = 1440, nBindState = -2, nCount=1, tbParam = {2}}
	tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongCayThienTueBatTu"})
end

function tbSpecialAward:BatTu2(nItemIdx)
	local tbSay = {}
	for i = 8, 9 do
		tinsert(tbSay, format("%s/#tbSpecialAward:GetAward(%d, %d, %d)", self.tbAward[i].szName, nItemIdx, i, 2))
	end
	Say("Xin h·y chän phÇn th­ëng", getn(tbSay), tbSay)
end

function tbSpecialAward:GetAward(nItemIdx, nAwardIDX, nLogID)
	local tbLogList = 
	{
		[1] = "PhanThuongBaoRuongNguyetThan", 
		[2] = "PhanThuongBaoRuongBatTu"
	}
	local tbAward = self.tbAward[nAwardIDX]
	if IsMyItem(nItemIdx) == 1 and RemoveItemByIndex(nItemIdx) == 1 then
		tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", tbLogList[nLogID]})
	end
end

tbAwardList = {
	[1] = {szName = "§iÓm Kinh NghiÖm", nExp=5000000},
	[2] = {szName = "§iÓm Kinh NghiÖm", nExp=6000000},
	[3] = {szName = "§iÓm Kinh NghiÖm", nExp=7000000},
	[4] = {szName = "§iÓm Kinh NghiÖm", nExp=8000000},
	[5] = {szName = "§iÓm Kinh NghiÖm", nExp=9000000},
	[6] = {szName = "§iÓm Kinh NghiÖm", nExp=10000000},
	[7] = {	szName = "PhÇn th­ëng c©y thiªn tuÕ nguyÖt thÇn",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:NguyetThan()
				end},
	[8] = {	szName = "PhÇn th­ëng c©y thiªn tuÕ bÊt tö",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BatTu()
				end},
	[9] = {szName="Tö M·ng LÖnh",tbProp={6,1,2350,1,0,0},nCount=1},
	[10] = 
	{
		{	szName = "PhÇn th­ëng c©y thiªn tuÕ b¹ch kim 1",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(3)
				end,
				nRate = 65,
		},
		{	szName = "PhÇn th­ëng c©y thiªn tuÕ b¹ch kim 2",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(4)
				end,
				nRate = 15,
		},
		{	szName = "PhÇn th­ëng c©y thiªn tuÕ b¹ch kim 3",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(5)
				end,
				nRate = 16,
		},
		{	szName = "PhÇn th­ëng c©y thiªn tuÕ b¹ch kim 4",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(6)
				end,
				nRate = 4,
		},
	}
}